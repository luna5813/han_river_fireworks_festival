<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>2026 ì—¬ì˜ë„ ë¶ˆê½ƒì¶•ì œ ì‹¤ì‹œê°„ ì§€ë„</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; font-family: 'Pretendard', sans-serif; }
        #map { width: 100vw; height: 100vh; z-index: 1; }
        .header { position: absolute; top: 0; left: 0; right: 0; background: rgba(26, 26, 46, 0.8); color:#fff; padding: 5px 0; text-align:center; z-index: 1001; border-bottom: 1px solid rgba(255, 107, 107, 0.3); }
        .header h1 { margin:0; font-size: 13px; font-weight: 400; }
        
        .control-panel { position: fixed; top: 40px; right: 10px; z-index: 1000; }
        .add-btn { padding: 7px 14px; background: #ff6b6b; color: white; border: none; border-radius: 15px; cursor: pointer; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.2); font-size: 12px; }
        .add-btn.active { background: #2ecc71; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }

        .legend { position: fixed; bottom: 15px; left: 10px; background: rgba(255,255,255,0.9); padding: 8px; border-radius: 8px; z-index: 1000; font-size: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #ddd; line-height: 1.5; }
        
        .status-badge { display: inline-block; padding: 1px 4px; border-radius: 3px; font-size: 9px; color: white; font-weight: bold; }
        .status-green { background: #2ecc71; } .status-yellow { background: #f1c40f; } .status-red { background: #e74c3c; }

        .popup-form { min-width: 150px; }
        .popup-form select, .popup-form input, .popup-form textarea { width: 100%; margin-bottom: 5px; padding: 7px; border-radius: 4px; border: 1px solid #ddd; font-size: 12px; box-sizing: border-box; }
        .save-btn { width: 100%; padding: 8px; background: #2ecc71; color: white; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 12px; }
    </style>
</head>
<body>

<div class="header"><h1>ğŸ‡ 2026 ì—¬ì˜ë„ ë¶ˆê½ƒì¶•ì œ ì§€ë„</h1></div>
<div id="map"></div>
<div class="control-panel"><button id="addBtn" class="add-btn" onclick="toggleAddMode()">ğŸ“ ëª…ë‹¹ ì œë³´</button></div>

<div class="legend">
    <strong>ğŸ‡ ë°œì‚¬ ìœ„ì¹˜</strong> | ğŸš½ í™”ì¥ì‹¤ | ğŸª í¸ì˜ì <br>
    ğŸŸ¢ ì¾Œì  ğŸŸ¡ ë³´í†µ ğŸ”´ í˜¼ì¡
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    firebase.initializeApp({ databaseURL: "https://fireworks-map-50c05-default-rtdb.firebaseio.com/" });
    const database = firebase.database();

    const map = L.map('map', { zoomControl: false }).setView([37.527, 126.945], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // [ë³µêµ¬ ì™„ë£Œ] í•˜ë“œì½”ë”© ëª…ë‹¹ ë°ì´í„°
    const defaultSpots = [
        { name: "ë…¸ë“¤ì„¬ ì”ë””ë§ˆë‹¹", lat: 37.5175, lng: 126.9580, rating: "â­â­â­â­â­", status: "ë³´í†µ", reason: "ê°• í•œê°€ìš´ë°ì„œ ì¦ê¸°ëŠ” íŒŒë…¸ë¼ë§ˆ ë·°" },
        { name: "ë§ˆí¬ëŒ€êµ ë³´ë„", lat: 37.5340, lng: 126.9365, rating: "â­â­â­", status: "í˜¼ì¡", reason: "í˜„ì¥ê°ì€ ìµœê³ ì§€ë§Œ í”ë“¤ë¦¼ê³¼ ì¸íŒŒ ì£¼ì˜" }
    ];

    // í¸ì˜ì‹œì„¤ ë°ì´í„°
    const facilities = [
        { name: "ì—¬ì˜ë„ í¸ì˜ì ", lat: 37.5270, lng: 126.9340, type: "ğŸª" },
        { name: "í•œê°•ê³µì› í™”ì¥ì‹¤", lat: 37.5285, lng: 126.9335, type: "ğŸš½" },
        { name: "ì›íš¨ëŒ€êµ í™”ì¥ì‹¤", lat: 37.5255, lng: 126.9405, type: "ğŸš½" }
    ];
    facilities.forEach(f => {
        L.marker([f.lat, f.lng], { icon: L.divIcon({ html: f.type, className: '', iconSize: [20, 20] }) }).bindPopup(f.name).addTo(map);
    });

    // ë°œì‚¬ ìœ„ì¹˜
    [[37.5338, 126.9355], [37.5300, 126.9390], [37.5265, 126.9425], [37.5200, 126.9495]].forEach(pos => {
        L.marker(pos, { icon: L.divIcon({ html: 'ğŸ‡', className: '', iconSize: [30, 30], iconAnchor: [15, 15] }) }).addTo(map);
        L.circle(pos, { color: '#ff4500', weight: 1, fillOpacity: 0.1, radius: 250 }).addTo(map);
    });

    function getStatusClass(s) { return s === "í˜¼ì¡" ? "status-red" : (s === "ë³´í†µ" ? "status-yellow" : "status-green"); }
    function getCustomIcon(status) {
        const color = status === "í˜¼ì¡" ? "#e74c3c" : (status === "ë³´í†µ" ? "#f1c40f" : "#2ecc71");
        return L.divIcon({
            html: `<div style="background:${color}; width:24px; height:24px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; border:1.5px solid white; font-size:10px;">â­</div>`,
            className: '', iconSize: [24, 24], iconAnchor: [12, 12]
        });
    }

    // ë°ì´í„° í‘œì‹œ (ê¸°ë³¸ + Firebase)
    const showSpot = (data) => {
        L.marker([data.lat, data.lng], { icon: getCustomIcon(data.status) })
            .bindPopup(`<strong>${data.name}</strong> <span class="status-badge ${getStatusClass(data.status)}">${data.status}</span><p style="font-size:11px; margin:3px 0;">${data.reason}</p>`).addTo(map);
    };

    defaultSpots.forEach(showSpot);
    database.ref('spots').on('child_added', (snap) => showSpot(snap.val()));

    let isAddMode = false;
    function toggleAddMode() {
        isAddMode = !isAddMode;
        document.getElementById('addBtn').innerText = isAddMode ? "ì§€ë„ í„°ì¹˜" : "ğŸ“ ëª…ë‹¹ ì œë³´";
        document.getElementById('addBtn').classList.toggle('active');
    }

    map.on('click', function(e) {
        if (!isAddMode) return;
        const id = Date.now();
        const content = `
            <div class="popup-form">
                <input type="text" id="name_${id}" placeholder="ì¥ì†Œëª…">
                <textarea id="reason_${id}" placeholder="ì¶”ì²œ ì´ìœ "></textarea>
                <select id="status_${id}">
                    <option value="ì¾Œì ">ğŸŸ¢ ì¾Œì </option>
                    <option value="ë³´í†µ" selected>ğŸŸ¡ ë³´í†µ</option>
                    <option value="í˜¼ì¡">ğŸ”´ í˜¼ì¡</option>
                </select>
                <button class="save-btn" onclick="saveToFirebase(${e.latlng.lat}, ${e.latlng.lng}, ${id})">ë“±ë¡</button>
            </div>`;
        L.popup().setLatLng(e.latlng).setContent(content).openOn(map);
        toggleAddMode();
    });

    window.saveToFirebase = function(lat, lng, id) {
        const name = document.getElementById(`name_${id}`).value;
        const reason = document.getElementById(`reason_${id}`).value;
        const status = document.getElementById(`status_${id}`).value;
        if(name && reason) {
            database.ref('spots').push({ name, reason, status, lat, lng }).then(() => map.closePopup());
        }
    };
</script>
</body>
</html>
