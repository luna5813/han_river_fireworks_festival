<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>서울 불꽃축제 명당 지도 | 여의도 한강 불꽃놀이 관람 장소</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="여의도 한강 불꽃축제 최고의 관람 명당을 찾아보세요. 63빌딩, 샛강역, 선유도공원 등 추천 장소와 실시간 지도 정보 제공. 직접 명당을 제안하고 공유할 수 있습니다."/>
    <meta name="keywords" content="불꽃축제, 여의도 불꽃축제, 한강 불꽃놀이, 불꽃축제 명당, 여의도 한강공원, 불꽃축제 관람 장소, 서울 불꽃놀이, 63빌딩 전망대, 샛강역, 선유도공원"/>
    <meta name="author" content="불꽃축제 명당 지도"/>
    <meta name="robots" content="index, follow"/>
    
    <!-- Open Graph (SNS 공유용) -->
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="서울 불꽃축제 명당 지도 | 여의도 한강 불꽃놀이 관람 장소"/>
    <meta property="og:description" content="여의도 한강 불꽃축제 최고의 관람 명당을 지도에서 확인하세요. 사용자 참여형 명당 추천 시스템."/>
    <meta property="og:image" content="https://via.placeholder.com/1200x630/ff6b6b/ffffff?text=%EB%B6%88%EA%BD%83%EC%B6%95%EC%A0%9C+%EB%AA%85%EB%8B%B9+%EC%A7%80%EB%8F%84"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:image:alt" content="서울 불꽃축제 명당 지도 미리보기"/>
    <meta property="og:site_name" content="불꽃축제 명당 지도"/>
    <meta property="og:locale" content="ko_KR"/>
    <meta property="og:url" content="https://luna5813.github.io/han_river_fireworks_festival/"/>
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:title" content="서울 불꽃축제 명당 지도"/>
    <meta name="twitter:description" content="여의도 한강 불꽃축제 최고의 관람 명당을 찾아보세요"/>
    <meta name="twitter:image" content="https://via.placeholder.com/1200x630/ff6b6b/ffffff?text=%EB%B6%88%EA%BD%83%EC%B6%95%EC%A0%9C+%EB%AA%85%EB%8B%B9+%EC%A7%80%EB%8F%84"/>
    
    <!-- 추가 SEO -->
    <meta name="theme-color" content="#ff6b6b"/>
    <link rel="canonical" href="https://luna5813.github.io/han_river_fireworks_festival/"/>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Leaflet.Draw CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.css"/>

    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: linear-gradient(135deg,#1e3c72,#2a5298); color:#222; }
        .header { background: linear-gradient(135deg,#ff6b6b,#ee5a6f); color:#fff; padding:18px; text-align:center; box-shadow:0 4px 20px rgba(0,0,0,0.25); }
        .header h1 { margin-bottom:6px; font-size:26px; }
        #map { width:100vw; height: calc(100vh - 96px); }

        .legend { position: fixed; bottom:30px; left:30px; background:#fff; padding:16px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.25); z-index:1000; max-width:320px; }
        .legend h3 { margin:0 0 10px 0; color:#ff6b6b; }
        .legend-item { display:flex; align-items:center; gap:10px; margin:8px 0; font-size:14px; }
        .legend-icon { width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; font-size:16px; }

        .filter-panel { position: fixed; top:110px; right:20px; background:#fff; padding:12px; border-radius:10px; box-shadow:0 4px 20px rgba(0,0,0,0.18); z-index:500; max-width:250px; }
        .filter-panel label { display:block; margin:6px 0; font-size:14px; }
        .quick-nav-box { background:#fff; padding:10px; border-radius:8px; box-shadow:0 4px 15px rgba(0,0,0,0.15); z-index:500; }
        .custom-popup .leaflet-popup-content-wrapper { background: linear-gradient(135deg,#667eea,#764ba2); color:#fff; border-radius:12px; }
        .custom-popup .leaflet-popup-content { margin:12px; font-size:14px; }
    </style>
</head>
<body>
<div class="header">
    <h1>🎆 불꽃축제 명당 지도 (OSM 참여형, 서울 전용) 🎇</h1>
    <p>OpenStreetMap 참여 기능을 통해 명당을 제안하거나 OSM 편집기에서 직접 편집할 수 있습니다.</p>
</div>

<div id="map"></div>

<div class="legend">
    <h3>🎯 명당 등급</h3>
    <div class="legend-item"><div class="legend-icon" style="background:#ff6b6b">⭐</div><div><strong>최고 명당</strong> - 시야 최상</div></div>
    <div class="legend-item"><div class="legend-icon" style="background:#4facfe">👍</div><div><strong>우수 명당</strong> - 접근 용이</div></div>
    <div class="legend-item"><div class="legend-icon" style="background:#43e97b">📍</div><div><strong>일반 명당</strong></div></div>
    <div class="legend-item"><div class="legend-icon" style="background:#fa709a">🎪</div><div><strong>축제 중심</strong> - 불꽃 발사 위치</div></div>
    <div class="legend-item"><div class="legend-icon" style="background:#7f8c8d">✚</div><div><strong>사용자 제안</strong> - OSM으로 제안/편집</div></div>
</div>

<div class="filter-panel">
    <h4 style="margin:0 0 10px 0;">필터</h4>
    <label><input type="checkbox" checked onchange="filterMarkers('best')"> 최고 명당</label><br/>
    <label><input type="checkbox" checked onchange="filterMarkers('good')"> 우수 명당</label><br/>
    <label><input type="checkbox" checked onchange="filterMarkers('normal')"> 일반 명당</label><br/>
    <label><input type="checkbox" checked onchange="filterMarkers('festival')"> 축제 중심</label><br/>
    <label><input type="checkbox" checked onchange="filterMarkers('user')"> 사용자 제안</label>
    <hr style="margin:10px 0;"/>
    <div style="margin-top:8px;">
        <button onclick="enableAddSpot()" style="width:100%; padding:8px; border:none; background:#667eea; color:#fff; border-radius:6px; cursor:pointer; font-size:13px;">📍 내 명당 제안</button>
        <small style="display:block; margin-top:6px; color:#666; font-size:11px; line-height:1.3;">마커를 찍고 정보를 입력한 뒤 저장하거나 OSM에 제안할 수 있습니다.</small>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

<script>
(function() {
    function initMap() {
        if (typeof L === 'undefined') {
            setTimeout(initMap, 100);
            return;
        }

    const map = L.map('map').setView([37.5248, 126.9471], 14);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors',
        maxZoom: 19
    }).addTo(map);

    let markers = { best: [], good: [], normal: [], festival: [], user: [] };

    function createIcon(type) {
        const icons = {
            best: { html: '⭐', color:'#ff6b6b' },
            good: { html: '👍', color:'#4facfe' },
            normal: { html: '📍', color:'#43e97b' },
            festival: { html: '🎪', color:'#fa709a' },
            user: { html: '✚', color:'#7f8c8d' }
        };
        const i = icons[type] || icons['normal'];
        return L.divIcon({
            html: '<div style="background:' + i.color + ';width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;color:white;border:3px solid white;">' + i.html + '</div>',
            className: '',
            iconSize: [40,40],
            iconAnchor: [20,20]
        });
    }

    const MAPO = [37.53361, 126.93639];
    const HANGANG = [37.5159, 126.9578];
    const FESTIVAL_CENTER = [ (MAPO[0] + HANGANG[0]) / 2, (MAPO[1] + HANGANG[1]) / 2 ];

    const spots = [
        {
            type: 'festival',
            name: '여의도 한강공원 불꽃 발사 지점 (실제 발사구간: 마포대교 ⇄ 한강대교)',
            coords: FESTIVAL_CENTER,
            rating: '🎆🎆🎆🎆🎆',
            info: '불꽃이 발사되는 중심 수역(마포대교 ~ 한강대교 구간 기준). 접근 제한 구역이 있을 수 있습니다.',
            crowd: '매우 높음',
            view: '중심부'
        },
        {
            type: 'best',
            name: '63빌딩 전망대',
            coords: [37.5197, 126.9394],
            rating: '⭐⭐⭐⭐⭐',
            info: '한강과 불꽃 전체를 조망 가능한 실내 전망대 (유료)',
            crowd: '낮음 (유료)',
            view: '최상급'
        },
        {
            type: 'best',
            name: '샛강역 인근 둔치',
            coords: [37.51727, 126.92842],
            rating: '⭐⭐⭐⭐⭐',
            info: '넓은 공간, 한적함. 정면 시야 확보 가능.',
            crowd: '낮음',
            view: '탁월함'
        },
        {
            type: 'good',
            name: '여의도공원 잔디밭',
            coords: [37.5265, 126.9242],
            rating: '⭐⭐⭐⭐',
            info: '가족 단위 추천, 넓은 잔디공간',
            crowd: '중간',
            view: '우수함'
        },
        {
            type: 'good',
            name: '선유도공원',
            coords: [37.5453, 126.8958],
            rating: '⭐⭐⭐⭐',
            info: '독특한 뷰 포인트, 사진 촬영 명소',
            crowd: '중간',
            view: '우수함'
        },
        {
            type: 'normal',
            name: '마포대교',
            coords: MAPO,
            rating: '⭐⭐⭐',
            info: '다리 위에서 보는 색다른 경험',
            crowd: '높음',
            view: '괜찮음'
        },
        {
            type: 'normal',
            name: '망원한강공원',
            coords: [37.5516, 126.8950],
            rating: '⭐⭐⭐',
            info: '접근성 좋음, 편의시설 多',
            crowd: '높음',
            view: '보통'
        }
    ];

    spots.forEach(function(spot) {
        var marker = L.marker(spot.coords, { icon: createIcon(spot.type) }).addTo(map);
        var popupContent = '<h4>' + spot.name + '</h4>' +
            '<div style="font-size:18px;margin:6px 0;">' + spot.rating + '</div>' +
            '<p><strong>시야:</strong> ' + spot.view + '</p>' +
            '<p><strong>혼잡도:</strong> ' + spot.crowd + '</p>' +
            '<p><strong>특징:</strong><br>' + spot.info + '</p>';
        marker.bindPopup(popupContent, { className:'custom-popup', maxWidth:300 });
        markers[spot.type].push(marker);
    });

    let filterState = { best:true, good:true, normal:true, festival:true, user:true };

    window.filterMarkers = function(type) {
        filterState[type] = !filterState[type];
        markers[type].forEach(function(m) {
            if (filterState[type]) m.addTo(map); else map.removeLayer(m);
        });
    }

    const festivalsNav = {
        yeouido: { center:[37.524755,126.947095], zoom:14, name:'여의도' }
    };

    const quickNav = L.control({ position: 'topright' });
    quickNav.onAdd = function() {
        const div = L.DomUtil.create('div', 'quick-nav-box');
        div.innerHTML = '<div style="width:220px;">' +
            '<h4 style="margin:0 0 8px 0; color:#ff6b6b;">빠른 이동 / OSM</h4>' +
            '<button onclick="moveTo(\'yeouido\')" style="width:100%;padding:6px;margin-bottom:6px;border:none;background:#667eea;color:#fff;border-radius:6px;cursor:pointer;">여의도 축제</button>' +
            '<hr/><small>OSM에 직접 반영하려면 아래 옵션을 이용하세요:</small>' +
            '<button onclick="openOSMNote()" style="width:100%;padding:6px;margin-top:6px;border:none;background:#2ecc71;color:#fff;border-radius:6px;cursor:pointer;">현재 중심에 OSM 노트 남기기</button>' +
            '<button onclick="openIDEditor()" style="width:100%;padding:6px;margin-top:6px;border:none;background:#f39c12;color:#fff;border-radius:6px;cursor:pointer;">현재 중심으로 iD 편집기 열기</button>' +
            '</div>';
        return div;
    };
    quickNav.addTo(map);

    window.moveTo = function(key) {
        const f = festivalsNav[key];
        map.flyTo(f.center, f.zoom, { duration: 1.2 });
    }

    window.openOSMNote = function() {
        const c = map.getCenter();
        window.open('https://www.openstreetmap.org/note/new?lat=' + c.lat + '&lon=' + c.lng, '_blank');
    }
    
    window.openIDEditor = function() {
        const c = map.getCenter();
        window.open('https://www.openstreetmap.org/edit?editor=id#map=18/' + c.lat + '/' + c.lng, '_blank');
    }

    const drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);

    const drawControl = new L.Control.Draw({
        position: 'topright',
        draw: {
            polyline: false,
            polygon: false,
            rectangle: false,
            circle: false,
            circlemarker: false,
            marker: { repeatMode: false }
        },
        edit: {
            featureGroup: drawnItems,
            edit: true,
            remove: true
        }
    });

    let drawControlAdded = false;
    window.enableAddSpot = function() {
        if (!drawControlAdded) {
            map.addControl(drawControl);
            drawControlAdded = true;
            alert('✅ 마커 추가 모드가 활성화되었습니다!');
        } else {
            alert('💡 마커 추가 모드가 이미 활성화되어 있습니다.');
        }
    }

    let currentUserMarker = null;

    map.on(L.Draw.Event.CREATED, function (event) {
        const layer = event.layer;
        const latlng = layer.getLatLng();

        if (currentUserMarker) {
            drawnItems.removeLayer(currentUserMarker);
        }

        currentUserMarker = layer;
        const uniqueId = 'spot_' + Date.now();

        const popupHtml = '<div style="padding:4px;">' +
            '<h4 style="margin:0 0 8px 0;color:#667eea;">내가 제안한 명당</h4>' +
            '<p style="margin:4px 0;font-size:12px;color:#666;">위도: ' + latlng.lat.toFixed(5) + ' / 경도: ' + latlng.lng.toFixed(5) + '</p>' +
            '<hr style="margin:8px 0;border:none;border-top:1px solid #eee;"/>' +
            '<label style="display:block;margin-bottom:4px;font-weight:bold;font-size:13px;">장소명:</label>' +
            '<input type="text" id="name_' + uniqueId + '" placeholder="예: 한강철교 근처 둔치" style="width:100%;padding:6px;margin-bottom:8px;border:1px solid #ddd;border-radius:4px;"/>' +
            '<label style="display:block;margin-bottom:4px;font-weight:bold;font-size:13px;">추천 이유:</label>' +
            '<textarea id="reason_' + uniqueId + '" placeholder="예: 불꽃이 정면으로 보이고 사람이 적어요" style="width:100%;padding:6px;margin-bottom:8px;border:1px solid #ddd;border-radius:4px;height:60px;resize:vertical;"></textarea>' +
            '<label style="display:block;margin-bottom:4px;font-weight:bold;font-size:13px;">등급 선택:</label>' +
            '<select id="rating_' + uniqueId + '" style="width:100%;padding:6px;margin-bottom:10px;border:1px solid #ddd;border-radius:4px;">' +
            '<option value="⭐⭐⭐⭐⭐">⭐⭐⭐⭐⭐ 최고 명당</option>' +
            '<option value="⭐⭐⭐⭐" selected>⭐⭐⭐⭐ 우수 명당</option>' +
            '<option value="⭐⭐⭐">⭐⭐⭐ 일반 명당</option>' +
            '</select>' +
            '<div style="display:flex;gap:6px;margin-top:10px;">' +
            '<button onclick="saveUserSpot(\'' + uniqueId + '\', ' + latlng.lat + ', ' + latlng.lng + ')" style="flex:1;padding:8px;border:none;background:#667eea;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold;">💾 저장</button>' +
            '<button onclick="submitSpotToOSM(\'' + uniqueId + '\', ' + latlng.lat + ', ' + latlng.lng + ')" style="flex:1;padding:8px;border:none;background:#2ecc71;color:#fff;border-radius:6px;cursor:pointer;">📤 OSM 제안</button>' +
            '</div>' +
            '<button onclick="cancelUserSpot()" style="width:100%;padding:6px;margin-top:6px;border:1px solid #ddd;background:#fff;color:#666;border-radius:6px;cursor:pointer;font-size:12px;">취소</button>' +
            '</div>';
        
        layer.bindPopup(popupHtml, { maxWidth:320, className:'custom-popup' }).openPopup();
        drawnItems.addLayer(layer);
        layer.setIcon(createIcon('user'));
    });

    window.saveUserSpot = function(id, lat, lon) {
        const name = document.getElementById('name_' + id).value || '사용자 제안 명당';
        const reason = document.getElementById('reason_' + id).value || '추천 이유 없음';
        const rating = document.getElementById('rating_' + id).value || '⭐⭐⭐⭐';

        if (!name.trim()) {
            alert('장소명을 입력해주세요!');
            return;
        }

        const savedPopup = '<div style="padding:4px;">' +
            '<h4 style="margin:0 0 6px 0;color:#667eea;">' + name + '</h4>' +
            '<div style="font-size:16px;margin:4px 0;">' + rating + '</div>' +
            '<p style="margin:4px 0;"><strong>위치:</strong> ' + lat.toFixed(5) + ', ' + lon.toFixed(5) + '</p>' +
            '<p style="margin:4px 0;"><strong>추천 이유:</strong><br>' + reason + '</p>' +
            '<div style="margin-top:10px;display:flex;gap:6px;">' +
            '<button onclick="submitSpotToOSM(\'' + id + '\', ' + lat + ', ' + lon + ')" style="flex:1;padding:6px;border:none;background:#2ecc71;color:#fff;border-radius:6px;cursor:pointer;font-size:12px;">📤 OSM 제안</button>' +
            '<button onclick="deleteUserSpot(' + lat + ', ' + lon + ')" style="flex:1;padding:6px;border:1px solid #e74c3c;background:#fff;color:#e74c3c;border-radius:6px;cursor:pointer;font-size:12px;">🗑️ 삭제</button>' +
            '</div></div>';

        if (currentUserMarker) {
            currentUserMarker.bindPopup(savedPopup, { maxWidth:320, className:'custom-popup' });
            currentUserMarker.setPopupContent(savedPopup);
            markers['user'].push(currentUserMarker);
            currentUserMarker = null;
        }

        alert('✅ 명당이 지도에 저장되었습니다!');
        map.closePopup();
    }

    window.submitSpotToOSM = function(id, lat, lon) {
        const name = document.getElementById('name_' + id).value || '사용자 제안 명당';
        const reason = document.getElementById('reason_' + id).value || '불꽃 관람 추천 장소';
        const rating = document.getElementById('rating_' + id).value || '⭐⭐⭐⭐';

        const noteText = encodeURIComponent(
            '🎆 불꽃축제 명당 제안\n' +
            '장소: ' + name + '\n' +
            '등급: ' + rating + '\n' +
            '추천 이유: ' + reason + '\n' +
            '[위치: ' + lat.toFixed(5) + ', ' + lon.toFixed(5) + ']'
        );

        window.open('https://www.openstreetmap.org/note/new?lat=' + lat + '&lon=' + lon + '&text=' + noteText, '_blank');
        alert('📤 OSM 노트 페이지가 열립니다!');
    }

    window.cancelUserSpot = function() {
        if (currentUserMarker) {
            drawnItems.removeLayer(currentUserMarker);
            currentUserMarker = null;
        }
        map.closePopup();
    }

    window.deleteUserSpot = function(lat, lon) {
        if (confirm('이 명당을 삭제하시겠습니까?')) {
            markers['user'] = markers['user'].filter(function(m) {
                const mLatLng = m.getLatLng();
                if (Math.abs(mLatLng.lat - lat) < 0.00001 && Math.abs(mLatLng.lng - lon) < 0.00001) {
                    drawnItems.removeLayer(m);
                    return false;
                }
                return true;
            });
            map.closePopup();
            alert('🗑️ 명당이 삭제되었습니다.');
        }
    }

    map.setView(FESTIVAL_CENTER, 14);

    const launchLine = L.polyline([MAPO, HANGANG], { color:'#ff6b6b', weight:4, dashArray:'6 6' }).addTo(map);
    launchLine.bindPopup('<strong>불꽃 발사 구간 (예시)</strong><br>마포대교 ⇄ 한강대교');

    L.popup({ closeOnClick:false, autoClose:false, closeButton:true })
        .setLatLng([FESTIVAL_CENTER[0], FESTIVAL_CENTER[1]])
        .setContent('<strong>팁</strong><br>오른쪽의 "내 명당 제안" 버튼으로 명당을 추가할 수 있습니다.')
        .openOn(map);
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initMap);
    } else {
        initMap();
    }
})();
</script>
</body>
</html>
