<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ì„œìš¸ ë¶ˆê½ƒì¶•ì œ ëª…ë‹¹ ì§€ë„ | ì—¬ì˜ë„ í•œê°• ë¶ˆê½ƒë†€ì´ ê´€ëŒ ì¥ì†Œ</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="ì—¬ì˜ë„ í•œê°• ë¶ˆê½ƒì¶•ì œ ìµœê³ ì˜ ê´€ëŒ ëª…ë‹¹ì„ ì°¾ì•„ë³´ì„¸ìš”. 63ë¹Œë”©, ìƒ›ê°•ì—­, ì„ ìœ ë„ê³µì› ë“± ì¶”ì²œ ì¥ì†Œì™€ ì‹¤ì‹œê°„ ì§€ë„ ì •ë³´ ì œê³µ. ì§ì ‘ ëª…ë‹¹ì„ ì œì•ˆí•˜ê³  ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."/>
    <meta name="keywords" content="ë¶ˆê½ƒì¶•ì œ, ì—¬ì˜ë„ ë¶ˆê½ƒì¶•ì œ, í•œê°• ë¶ˆê½ƒë†€ì´, ë¶ˆê½ƒì¶•ì œ ëª…ë‹¹, ì—¬ì˜ë„ í•œê°•ê³µì›, ë¶ˆê½ƒì¶•ì œ ê´€ëŒ ì¥ì†Œ, ì„œìš¸ ë¶ˆê½ƒë†€ì´, 63ë¹Œë”© ì „ë§ëŒ€, ìƒ›ê°•ì—­, ì„ ìœ ë„ê³µì›"/>
    <meta name="author" content="ë¶ˆê½ƒì¶•ì œ ëª…ë‹¹ ì§€ë„"/>
    <meta name="robots" content="index, follow"/>
    
    <!-- Open Graph (SNS ê³µìœ ìš©) -->
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="ì„œìš¸ ë¶ˆê½ƒì¶•ì œ ëª…ë‹¹ ì§€ë„ | ì—¬ì˜ë„ í•œê°• ë¶ˆê½ƒë†€ì´ ê´€ëŒ ì¥ì†Œ"/>
    <meta property="og:description" content="ì—¬ì˜ë„ í•œê°• ë¶ˆê½ƒì¶•ì œ ìµœê³ ì˜ ê´€ëŒ ëª…ë‹¹ì„ ì§€ë„ì—ì„œ í™•ì¸í•˜ì„¸ìš”. ì‚¬ìš©ì ì°¸ì—¬í˜• ëª…ë‹¹ ì¶”ì²œ ì‹œìŠ¤í…œ."/>
    <meta property="og:image" content="https://via.placeholder.com/1200x630/ff6b6b/ffffff?text=%EB%B6%88%EA%BD%83%EC%B6%95%EC%A0%9C+%EB%AA%85%EB%8B%B9+%EC%A7%80%EB%8F%84"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:image:alt" content="ì„œìš¸ ë¶ˆê½ƒì¶•ì œ ëª…ë‹¹ ì§€ë„ ë¯¸ë¦¬ë³´ê¸°"/>
    <meta property="og:site_name" content="ë¶ˆê½ƒì¶•ì œ ëª…ë‹¹ ì§€ë„"/>
    <meta property="og:locale" content="ko_KR"/>
    <meta property="og:url" content="https://luna5813.github.io/han_river_fireworks_festival/"/>
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:title" content="ì„œìš¸ ë¶ˆê½ƒì¶•ì œ ëª…ë‹¹ ì§€ë„"/>
    <meta name="twitter:description" content="ì—¬ì˜ë„ í•œê°• ë¶ˆê½ƒì¶•ì œ ìµœê³ ì˜ ê´€ëŒ ëª…ë‹¹ì„ ì°¾ì•„ë³´ì„¸ìš”"/>
    <meta name="twitter:image" content="https://via.placeholder.com/1200x630/ff6b6b/ffffff?text=%EB%B6%88%EA%BD%83%EC%B6%95%EC%A0%9C+%EB%AA%85%EB%8B%B9+%EC%A7%80%EB%8F%84"/>
    
    <!-- ì¶”ê°€ SEO -->
    <meta name="theme-color" content="#ff6b6b"/>
    <link rel="canonical" href="https://luna5813.github.io/han_river_fireworks_festival/"/>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Leaflet.Draw CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.css"/>

    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: linear-gradient(135deg,#1e3c72,#2a5298); color:#222; }
        .header { background: linear-gradient(135deg,#ff6b6b,#ee5a6f); color:#fff; padding:18px; text-align:center; box-shadow:0 4px 20px rgba(0,0,0,0.25); }
        .header h1 { margin-bottom:6px; font-size:26px; }
        #map { width:100vw; height: calc(100vh - 96px); }

        .legend { position: fixed; bottom:30px; left:30px; background:#fff; padding:16px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.25); z-index:1000; max-width:320px; }
        .legend h3 { margin:0 0 10px 0; color:#ff6b6b; }
        .legend-item { display:flex; align-items:center; gap:10px; margin:8px 0; font-size:14px; }
        .legend-icon { width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; font-size:16px; }

        .filter-panel { position: fixed; top:110px; right:20px; background:#fff; padding:12px; border-radius:10px; box-shadow:0 4px 20px rgba(0,0,0,0.18); z-index:500; max-width:250px; }
        .filter-panel label { display:block; margin:6px 0; font-size:14px; }
        .quick-nav-box { background:#fff; padding:10px; border-radius:8px; box-shadow:0 4px 15px rgba(0,0,0,0.15); z-index:500; }
        .custom-popup .leaflet-popup-content-wrapper { background: linear-gradient(135deg,#667eea,#764ba2); color:#fff; border-radius:12px; }
        .custom-popup .leaflet-popup-content { margin:12px; font-size:14px; }
    </style>
</head>
<body>
<div class="header">
    <h1>ğŸ† ë¶ˆê½ƒì¶•ì œ ëª…ë‹¹ ì§€ë„ (OSM ì°¸ì—¬í˜•, ì„œìš¸ ì „ìš©) ğŸ‡</h1>
    <p>OpenStreetMap ì°¸ì—¬ ê¸°ëŠ¥ì„ í†µí•´ ëª…ë‹¹ì„ ì œì•ˆí•˜ê±°ë‚˜ OSM í¸ì§‘ê¸°ì—ì„œ ì§ì ‘ í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</div>

<div id="map"></div>

<div class="legend">
    <h3>ğŸ¯ ëª…ë‹¹ ë“±ê¸‰</h3>
    <div class="legend-item"><div class="legend-icon" style="background:#ff6b6b">â­</div><div><strong>ìµœê³  ëª…ë‹¹</strong> - ì‹œì•¼ ìµœìƒ</div></div>
    <div class="legend-item"><div class="legend-icon" style="background:#4facfe">ğŸ‘</div><div><strong>ìš°ìˆ˜ ëª…ë‹¹</strong> - ì ‘ê·¼ ìš©ì´</div></div>
    <div class="legend-item"><div class="legend-icon" style="background:#43e97b">ğŸ“</div><div><strong>ì¼ë°˜ ëª…ë‹¹</strong></div></div>
    <div class="legend-item"><div class="legend-icon" style="background:#fa709a">ğŸª</div><div><strong>ì¶•ì œ ì¤‘ì‹¬</strong> - ë¶ˆê½ƒ ë°œì‚¬ ìœ„ì¹˜</div></div>
    <div class="legend-item"><div class="legend-icon" style="background:#7f8c8d">âœš</div><div><strong>ì‚¬ìš©ì ì œì•ˆ</strong> - OSMìœ¼ë¡œ ì œì•ˆ/í¸ì§‘</div></div>
</div>

<div class="filter-panel">
    <h4 style="margin:0 0 10px 0;">í•„í„°</h4>
    <label><input type="checkbox" checked onchange="filterMarkers('best')"> ìµœê³  ëª…ë‹¹</label><br/>
    <label><input type="checkbox" checked onchange="filterMarkers('good')"> ìš°ìˆ˜ ëª…ë‹¹</label><br/>
    <label><input type="checkbox" checked onchange="filterMarkers('normal')"> ì¼ë°˜ ëª…ë‹¹</label><br/>
    <label><input type="checkbox" checked onchange="filterMarkers('festival')"> ì¶•ì œ ì¤‘ì‹¬</label><br/>
    <label><input type="checkbox" checked onchange="filterMarkers('user')"> ì‚¬ìš©ì ì œì•ˆ</label>
    <hr style="margin:10px 0;"/>
    <div style="margin-top:8px;">
        <button onclick="enableAddSpot()" style="width:100%; padding:8px; border:none; background:#667eea; color:#fff; border-radius:6px; cursor:pointer; font-size:13px;">ğŸ“ ë‚´ ëª…ë‹¹ ì œì•ˆ</button>
        <small style="display:block; margin-top:6px; color:#666; font-size:11px; line-height:1.3;">ë§ˆì»¤ë¥¼ ì°ê³  ì •ë³´ë¥¼ ì…ë ¥í•œ ë’¤ ì €ì¥í•˜ê±°ë‚˜ OSMì— ì œì•ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</small>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

<script>
(function() {
    function initMap() {
        if (typeof L === 'undefined') {
            setTimeout(initMap, 100);
            return;
        }

    const map = L.map('map').setView([37.5248, 126.9471], 14);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors',
        maxZoom: 19
    }).addTo(map);

    let markers = { best: [], good: [], normal: [], festival: [], user: [] };

    function createIcon(type) {
        const icons = {
            best: { html: 'â­', color:'#ff6b6b' },
            good: { html: 'ğŸ‘', color:'#4facfe' },
            normal: { html: 'ğŸ“', color:'#43e97b' },
            festival: { html: 'ğŸª', color:'#fa709a' },
            user: { html: 'âœš', color:'#7f8c8d' }
        };
        const i = icons[type] || icons['normal'];
        return L.divIcon({
            html: '<div style="background:' + i.color + ';width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;color:white;border:3px solid white;">' + i.html + '</div>',
            className: '',
            iconSize: [40,40],
            iconAnchor: [20,20]
        });
    }

    const MAPO = [37.53361, 126.93639];
    const HANGANG = [37.5159, 126.9578];
    const FESTIVAL_CENTER = [ (MAPO[0] + HANGANG[0]) / 2, (MAPO[1] + HANGANG[1]) / 2 ];

    const spots = [
        {
            type: 'festival',
            name: 'ì—¬ì˜ë„ í•œê°•ê³µì› ë¶ˆê½ƒ ë°œì‚¬ ì§€ì  (ì‹¤ì œ ë°œì‚¬êµ¬ê°„: ë§ˆí¬ëŒ€êµ â‡„ í•œê°•ëŒ€êµ)',
            coords: FESTIVAL_CENTER,
            rating: 'ğŸ†ğŸ†ğŸ†ğŸ†ğŸ†',
            info: 'ë¶ˆê½ƒì´ ë°œì‚¬ë˜ëŠ” ì¤‘ì‹¬ ìˆ˜ì—­(ë§ˆí¬ëŒ€êµ ~ í•œê°•ëŒ€êµ êµ¬ê°„ ê¸°ì¤€). ì ‘ê·¼ ì œí•œ êµ¬ì—­ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
            crowd: 'ë§¤ìš° ë†’ìŒ',
            view: 'ì¤‘ì‹¬ë¶€'
        },
        {
            type: 'best',
            name: '63ë¹Œë”© ì „ë§ëŒ€',
            coords: [37.5197, 126.9394],
            rating: 'â­â­â­â­â­',
            info: 'í•œê°•ê³¼ ë¶ˆê½ƒ ì „ì²´ë¥¼ ì¡°ë§ ê°€ëŠ¥í•œ ì‹¤ë‚´ ì „ë§ëŒ€ (ìœ ë£Œ)',
            crowd: 'ë‚®ìŒ (ìœ ë£Œ)',
            view: 'ìµœìƒê¸‰'
        },
        {
            type: 'best',
            name: 'ìƒ›ê°•ì—­ ì¸ê·¼ ë‘”ì¹˜',
            coords: [37.51727, 126.92842],
            rating: 'â­â­â­â­â­',
            info: 'ë„“ì€ ê³µê°„, í•œì í•¨. ì •ë©´ ì‹œì•¼ í™•ë³´ ê°€ëŠ¥.',
            crowd: 'ë‚®ìŒ',
            view: 'íƒì›”í•¨'
        },
        {
            type: 'good',
            name: 'ì—¬ì˜ë„ê³µì› ì”ë””ë°­',
            coords: [37.5265, 126.9242],
            rating: 'â­â­â­â­',
            info: 'ê°€ì¡± ë‹¨ìœ„ ì¶”ì²œ, ë„“ì€ ì”ë””ê³µê°„',
            crowd: 'ì¤‘ê°„',
            view: 'ìš°ìˆ˜í•¨'
        },
        {
            type: 'good',
            name: 'ì„ ìœ ë„ê³µì›',
            coords: [37.5453, 126.8958],
            rating: 'â­â­â­â­',
            info: 'ë…íŠ¹í•œ ë·° í¬ì¸íŠ¸, ì‚¬ì§„ ì´¬ì˜ ëª…ì†Œ',
            crowd: 'ì¤‘ê°„',
            view: 'ìš°ìˆ˜í•¨'
        },
        {
            type: 'normal',
            name: 'ë§ˆí¬ëŒ€êµ',
            coords: MAPO,
            rating: 'â­â­â­',
            info: 'ë‹¤ë¦¬ ìœ„ì—ì„œ ë³´ëŠ” ìƒ‰ë‹¤ë¥¸ ê²½í—˜',
            crowd: 'ë†’ìŒ',
            view: 'ê´œì°®ìŒ'
        },
        {
            type: 'normal',
            name: 'ë§ì›í•œê°•ê³µì›',
            coords: [37.5516, 126.8950],
            rating: 'â­â­â­',
            info: 'ì ‘ê·¼ì„± ì¢‹ìŒ, í¸ì˜ì‹œì„¤ å¤š',
            crowd: 'ë†’ìŒ',
            view: 'ë³´í†µ'
        }
    ];

    spots.forEach(function(spot) {
        var marker = L.marker(spot.coords, { icon: createIcon(spot.type) }).addTo(map);
        var popupContent = '<h4>' + spot.name + '</h4>' +
            '<div style="font-size:18px;margin:6px 0;">' + spot.rating + '</div>' +
            '<p><strong>ì‹œì•¼:</strong> ' + spot.view + '</p>' +
            '<p><strong>í˜¼ì¡ë„:</strong> ' + spot.crowd + '</p>' +
            '<p><strong>íŠ¹ì§•:</strong><br>' + spot.info + '</p>';
        marker.bindPopup(popupContent, { className:'custom-popup', maxWidth:300 });
        markers[spot.type].push(marker);
    });

    let filterState = { best:true, good:true, normal:true, festival:true, user:true };

    window.filterMarkers = function(type) {
        filterState[type] = !filterState[type];
        markers[type].forEach(function(m) {
            if (filterState[type]) m.addTo(map); else map.removeLayer(m);
        });
    }

    const festivalsNav = {
        yeouido: { center:[37.524755,126.947095], zoom:14, name:'ì—¬ì˜ë„' }
    };

    const quickNav = L.control({ position: 'topright' });
    quickNav.onAdd = function() {
        const div = L.DomUtil.create('div', 'quick-nav-box');
        div.innerHTML = '<div style="width:220px;">' +
            '<h4 style="margin:0 0 8px 0; color:#ff6b6b;">ë¹ ë¥¸ ì´ë™ / OSM</h4>' +
            '<button onclick="moveTo(\'yeouido\')" style="width:100%;padding:6px;margin-bottom:6px;border:none;background:#667eea;color:#fff;border-radius:6px;cursor:pointer;">ì—¬ì˜ë„ ì¶•ì œ</button>' +
            '<hr/><small>OSMì— ì§ì ‘ ë°˜ì˜í•˜ë ¤ë©´ ì•„ë˜ ì˜µì…˜ì„ ì´ìš©í•˜ì„¸ìš”:</small>' +
            '<button onclick="openOSMNote()" style="width:100%;padding:6px;margin-top:6px;border:none;background:#2ecc71;color:#fff;border-radius:6px;cursor:pointer;">í˜„ì¬ ì¤‘ì‹¬ì— OSM ë…¸íŠ¸ ë‚¨ê¸°ê¸°</button>' +
            '<button onclick="openIDEditor()" style="width:100%;padding:6px;margin-top:6px;border:none;background:#f39c12;color:#fff;border-radius:6px;cursor:pointer;">í˜„ì¬ ì¤‘ì‹¬ìœ¼ë¡œ iD í¸ì§‘ê¸° ì—´ê¸°</button>' +
            '</div>';
        return div;
    };
    quickNav.addTo(map);

    window.moveTo = function(key) {
        const f = festivalsNav[key];
        map.flyTo(f.center, f.zoom, { duration: 1.2 });
    }

    window.openOSMNote = function() {
        const c = map.getCenter();
        window.open('https://www.openstreetmap.org/note/new?lat=' + c.lat + '&lon=' + c.lng, '_blank');
    }
    
    window.openIDEditor = function() {
        const c = map.getCenter();
        window.open('https://www.openstreetmap.org/edit?editor=id#map=18/' + c.lat + '/' + c.lng, '_blank');
    }

    const drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);

    const drawControl = new L.Control.Draw({
        position: 'topright',
        draw: {
            polyline: false,
            polygon: false,
            rectangle: false,
            circle: false,
            circlemarker: false,
            marker: { repeatMode: false }
        },
        edit: {
            featureGroup: drawnItems,
            edit: true,
            remove: true
        }
    });

    let drawControlAdded = false;
    window.enableAddSpot = function() {
        if (!drawControlAdded) {
            map.addControl(drawControl);
            drawControlAdded = true;
            alert('âœ… ë§ˆì»¤ ì¶”ê°€ ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
        } else {
            alert('ğŸ’¡ ë§ˆì»¤ ì¶”ê°€ ëª¨ë“œê°€ ì´ë¯¸ í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
        }
    }

    let currentUserMarker = null;

    map.on(L.Draw.Event.CREATED, function (event) {
        const layer = event.layer;
        const latlng = layer.getLatLng();

        if (currentUserMarker) {
            drawnItems.removeLayer(currentUserMarker);
        }

        currentUserMarker = layer;
        const uniqueId = 'spot_' + Date.now();

        const popupHtml = '<div style="padding:4px;">' +
            '<h4 style="margin:0 0 8px 0;color:#667eea;">ë‚´ê°€ ì œì•ˆí•œ ëª…ë‹¹</h4>' +
            '<p style="margin:4px 0;font-size:12px;color:#666;">ìœ„ë„: ' + latlng.lat.toFixed(5) + ' / ê²½ë„: ' + latlng.lng.toFixed(5) + '</p>' +
            '<hr style="margin:8px 0;border:none;border-top:1px solid #eee;"/>' +
            '<label style="display:block;margin-bottom:4px;font-weight:bold;font-size:13px;">ì¥ì†Œëª…:</label>' +
            '<input type="text" id="name_' + uniqueId + '" placeholder="ì˜ˆ: í•œê°•ì² êµ ê·¼ì²˜ ë‘”ì¹˜" style="width:100%;padding:6px;margin-bottom:8px;border:1px solid #ddd;border-radius:4px;"/>' +
            '<label style="display:block;margin-bottom:4px;font-weight:bold;font-size:13px;">ì¶”ì²œ ì´ìœ :</label>' +
            '<textarea id="reason_' + uniqueId + '" placeholder="ì˜ˆ: ë¶ˆê½ƒì´ ì •ë©´ìœ¼ë¡œ ë³´ì´ê³  ì‚¬ëŒì´ ì ì–´ìš”" style="width:100%;padding:6px;margin-bottom:8px;border:1px solid #ddd;border-radius:4px;height:60px;resize:vertical;"></textarea>' +
            '<label style="display:block;margin-bottom:4px;font-weight:bold;font-size:13px;">ë“±ê¸‰ ì„ íƒ:</label>' +
            '<select id="rating_' + uniqueId + '" style="width:100%;padding:6px;margin-bottom:10px;border:1px solid #ddd;border-radius:4px;">' +
            '<option value="â­â­â­â­â­">â­â­â­â­â­ ìµœê³  ëª…ë‹¹</option>' +
            '<option value="â­â­â­â­" selected>â­â­â­â­ ìš°ìˆ˜ ëª…ë‹¹</option>' +
            '<option value="â­â­â­">â­â­â­ ì¼ë°˜ ëª…ë‹¹</option>' +
            '</select>' +
            '<div style="display:flex;gap:6px;margin-top:10px;">' +
            '<button onclick="saveUserSpot(\'' + uniqueId + '\', ' + latlng.lat + ', ' + latlng.lng + ')" style="flex:1;padding:8px;border:none;background:#667eea;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold;">ğŸ’¾ ì €ì¥</button>' +
            '<button onclick="submitSpotToOSM(\'' + uniqueId + '\', ' + latlng.lat + ', ' + latlng.lng + ')" style="flex:1;padding:8px;border:none;background:#2ecc71;color:#fff;border-radius:6px;cursor:pointer;">ğŸ“¤ OSM ì œì•ˆ</button>' +
            '</div>' +
            '<button onclick="cancelUserSpot()" style="width:100%;padding:6px;margin-top:6px;border:1px solid #ddd;background:#fff;color:#666;border-radius:6px;cursor:pointer;font-size:12px;">ì·¨ì†Œ</button>' +
            '</div>';
        
        layer.bindPopup(popupHtml, { maxWidth:320, className:'custom-popup' }).openPopup();
        drawnItems.addLayer(layer);
        layer.setIcon(createIcon('user'));
    });

    window.saveUserSpot = function(id, lat, lon) {
        const name = document.getElementById('name_' + id).value || 'ì‚¬ìš©ì ì œì•ˆ ëª…ë‹¹';
        const reason = document.getElementById('reason_' + id).value || 'ì¶”ì²œ ì´ìœ  ì—†ìŒ';
        const rating = document.getElementById('rating_' + id).value || 'â­â­â­â­';

        if (!name.trim()) {
            alert('ì¥ì†Œëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            return;
        }

        const savedPopup = '<div style="padding:4px;">' +
            '<h4 style="margin:0 0 6px 0;color:#667eea;">' + name + '</h4>' +
            '<div style="font-size:16px;margin:4px 0;">' + rating + '</div>' +
            '<p style="margin:4px 0;"><strong>ìœ„ì¹˜:</strong> ' + lat.toFixed(5) + ', ' + lon.toFixed(5) + '</p>' +
            '<p style="margin:4px 0;"><strong>ì¶”ì²œ ì´ìœ :</strong><br>' + reason + '</p>' +
            '<div style="margin-top:10px;display:flex;gap:6px;">' +
            '<button onclick="submitSpotToOSM(\'' + id + '\', ' + lat + ', ' + lon + ')" style="flex:1;padding:6px;border:none;background:#2ecc71;color:#fff;border-radius:6px;cursor:pointer;font-size:12px;">ğŸ“¤ OSM ì œì•ˆ</button>' +
            '<button onclick="deleteUserSpot(' + lat + ', ' + lon + ')" style="flex:1;padding:6px;border:1px solid #e74c3c;background:#fff;color:#e74c3c;border-radius:6px;cursor:pointer;font-size:12px;">ğŸ—‘ï¸ ì‚­ì œ</button>' +
            '</div></div>';

        if (currentUserMarker) {
            currentUserMarker.bindPopup(savedPopup, { maxWidth:320, className:'custom-popup' });
            currentUserMarker.setPopupContent(savedPopup);
            markers['user'].push(currentUserMarker);
            currentUserMarker = null;
        }

        alert('âœ… ëª…ë‹¹ì´ ì§€ë„ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        map.closePopup();
    }

    window.submitSpotToOSM = function(id, lat, lon) {
        const name = document.getElementById('name_' + id).value || 'ì‚¬ìš©ì ì œì•ˆ ëª…ë‹¹';
        const reason = document.getElementById('reason_' + id).value || 'ë¶ˆê½ƒ ê´€ëŒ ì¶”ì²œ ì¥ì†Œ';
        const rating = document.getElementById('rating_' + id).value || 'â­â­â­â­';

        const noteText = encodeURIComponent(
            'ğŸ† ë¶ˆê½ƒì¶•ì œ ëª…ë‹¹ ì œì•ˆ\n' +
            'ì¥ì†Œ: ' + name + '\n' +
            'ë“±ê¸‰: ' + rating + '\n' +
            'ì¶”ì²œ ì´ìœ : ' + reason + '\n' +
            '[ìœ„ì¹˜: ' + lat.toFixed(5) + ', ' + lon.toFixed(5) + ']'
        );

        window.open('https://www.openstreetmap.org/note/new?lat=' + lat + '&lon=' + lon + '&text=' + noteText, '_blank');
        alert('ğŸ“¤ OSM ë…¸íŠ¸ í˜ì´ì§€ê°€ ì—´ë¦½ë‹ˆë‹¤!');
    }

    window.cancelUserSpot = function() {
        if (currentUserMarker) {
            drawnItems.removeLayer(currentUserMarker);
            currentUserMarker = null;
        }
        map.closePopup();
    }

    window.deleteUserSpot = function(lat, lon) {
        if (confirm('ì´ ëª…ë‹¹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            markers['user'] = markers['user'].filter(function(m) {
                const mLatLng = m.getLatLng();
                if (Math.abs(mLatLng.lat - lat) < 0.00001 && Math.abs(mLatLng.lng - lon) < 0.00001) {
                    drawnItems.removeLayer(m);
                    return false;
                }
                return true;
            });
            map.closePopup();
            alert('ğŸ—‘ï¸ ëª…ë‹¹ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
    }

    map.setView(FESTIVAL_CENTER, 14);

    const launchLine = L.polyline([MAPO, HANGANG], { color:'#ff6b6b', weight:4, dashArray:'6 6' }).addTo(map);
    launchLine.bindPopup('<strong>ë¶ˆê½ƒ ë°œì‚¬ êµ¬ê°„ (ì˜ˆì‹œ)</strong><br>ë§ˆí¬ëŒ€êµ â‡„ í•œê°•ëŒ€êµ');

    L.popup({ closeOnClick:false, autoClose:false, closeButton:true })
        .setLatLng([FESTIVAL_CENTER[0], FESTIVAL_CENTER[1]])
        .setContent('<strong>íŒ</strong><br>ì˜¤ë¥¸ìª½ì˜ "ë‚´ ëª…ë‹¹ ì œì•ˆ" ë²„íŠ¼ìœ¼ë¡œ ëª…ë‹¹ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')
        .openOn(map);
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initMap);
    } else {
        initMap();
    }
})();
</script>
</body>
</html>
