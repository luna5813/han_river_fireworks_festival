<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>2026 ì—¬ì˜ë„ ë¶ˆê½ƒì¶•ì œ ì‹¤ì‹œê°„ ì§€ë„</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; font-family: 'Pretendard', sans-serif; }
        #map { width: 100vw; height: 100vh; z-index: 1; }
        
        /* ì–‡ê³  ì„¸ë ¨ëœ ìƒë‹¨ í—¤ë” */
        .header { 
            position: absolute; top: 0; left: 0; right: 0; 
            background: rgba(26, 26, 46, 0.8); 
            color:#fff; padding: 5px 0; /* ë‘ê»˜ ìµœì†Œí™” */
            text-align:center; z-index: 1001; 
            border-bottom: 1px solid rgba(255, 107, 107, 0.3); 
        }
        .header h1 { margin:0; font-size: 13px; font-weight: 400; letter-spacing: -0.5px; opacity: 0.9; }

        .firework-marker { font-size: 22px; text-align: center; pointer-events: none; }
        
        /* ë²„íŠ¼ ìœ„ì¹˜ ìµœì í™” */
        .control-panel { position: fixed; top: 40px; right: 10px; z-index: 1000; }
        .add-btn { 
            padding: 7px 14px; background: #ff6b6b; color: white; border: none; 
            border-radius: 15px; cursor: pointer; font-weight: bold; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.2); font-size: 12px; 
        }
        .add-btn.active { background: #2ecc71; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }

        .legend { 
            position: fixed; bottom: 15px; left: 10px; background: rgba(255,255,255,0.9); 
            padding: 6px 10px; border-radius: 8px; z-index: 1000; font-size: 10px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #ddd; 
        }
        .popup-form { min-width: 150px; }
        .popup-form input, .popup-form textarea, .popup-form select { 
            width: 100%; margin-bottom: 5px; padding: 7px; border-radius: 4px; 
            border: 1px solid #ddd; font-size: 12px; box-sizing: border-box; 
        }
        .save-btn { width: 100%; padding: 8px; background: #2ecc71; color: white; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 12px; }
    </style>
</head>
<body>

<div class="header"><h1>ğŸ‡ 2026 ì—¬ì˜ë„ ë¶ˆê½ƒì¶•ì œ ì§€ë„</h1></div>
<div id="map"></div>
<div class="control-panel"><button id="addBtn" class="add-btn" onclick="toggleAddMode()">ğŸ“ ëª…ë‹¹ ì œë³´</button></div>

<div class="legend">
    <strong>ğŸ‡ ë°œì‚¬ ìœ„ì¹˜</strong> | â­ ìµœê³  | âœ¨ ìš°ìˆ˜ | ğŸ“ ì¼ë°˜
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const firebaseConfig = { databaseURL: "https://fireworks-map-50c05-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const map = L.map('map', { zoomControl: false }).setView([37.527, 126.945], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // [ë³µêµ¬] í•˜ë“œì½”ë”©ëœ ì£¼ìš” ëª…ë‹¹ ì§€ì—­
    const defaultSpots = [
        { name: "ë…¸ë“¤ì„¬ ì”ë””ë§ˆë‹¹", lat: 37.5175, lng: 126.9580, rating: "â­â­â­â­â­", reason: "ê°• í•œê°€ìš´ë°ì„œ ì¦ê¸°ëŠ” íŒŒë…¸ë¼ë§ˆ ë·°" },
        { name: "ë§ˆí¬ëŒ€êµ ë³´ë„", lat: 37.5340, lng: 126.9365, rating: "â­â­â­", reason: "í˜„ì¥ê°ì€ ìµœê³ ì§€ë§Œ í”ë“¤ë¦¼ê³¼ ì¸íŒŒ ì£¼ì˜" }
    ];

    // ìˆ˜ìƒ ë°œì‚¬ ìœ„ì¹˜
    const bargePositions = [
        [37.5338, 126.9355], [37.5300, 126.9390], [37.5265, 126.9425], [37.5200, 126.9495]
    ];
    bargePositions.forEach(pos => {
        L.marker(pos, { icon: L.divIcon({ className: 'firework-marker', html: 'ğŸ‡', iconSize: [30, 30], iconAnchor: [15, 15] }) }).addTo(map);
        L.circle(pos, { color: '#ff4500', weight: 1, fillColor: '#ffcc00', fillOpacity: 0.1, radius: 250 }).addTo(map);
    });

    function getCustomIcon(rating) {
        let iconHtml = 'ğŸ“'; let bgColor = '#4facfe';
        if (rating === "â­â­â­â­â­") { iconHtml = 'â­'; bgColor = '#FFD700'; }
        else if (rating === "â­â­â­â­") { iconHtml = 'âœ¨'; bgColor = '#C0C0C0'; }
        return L.divIcon({
            html: `<div style="background:${bgColor}; width:26px; height:26px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px; color:white; border:1.5px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">${iconHtml}</div>`,
            className: '', iconSize: [26, 26], iconAnchor: [13, 13]
        });
    }

    // ê¸°ë³¸ ëª…ë‹¹ í‘œì‹œ ì‹¤í–‰
    defaultSpots.forEach(spot => {
        L.marker([spot.lat, spot.lng], { icon: getCustomIcon(spot.rating) })
            .bindPopup(`<strong>${spot.name}</strong><br>${spot.rating}<p style="font-size:11px; margin:3px 0 0 0;">${spot.reason}</p>`).addTo(map);
    });

    database.ref('spots').on('child_added', (snapshot) => {
        const data = snapshot.val();
        L.marker([data.lat, data.lng], { icon: getCustomIcon(data.rating) })
            .bindPopup(`<strong>${data.name}</strong><br>${data.rating}<p style="font-size:11px; margin:3px 0 0 0;">${data.reason}</p>`).addTo(map);
    });

    let isAddMode = false;
    function toggleAddMode() {
        isAddMode = !isAddMode;
        const btn = document.getElementById('addBtn');
        if (isAddMode) {
            btn.innerText = "ì§€ë„ í„°ì¹˜í•˜ì—¬ ì„ íƒ";
            btn.classList.add('active');
        } else {
            btn.innerText = "ğŸ“ ëª…ë‹¹ ì œë³´";
            btn.classList.remove('active');
        }
    }

    map.on('click', function(e) {
        if (!isAddMode) return;
        const latlng = e.latlng;
        const id = Date.now();
        const content = `
            <div class="popup-form">
                <strong style="font-size:12px;">ğŸ“ ëª…ë‹¹ ì œë³´</strong>
                <input type="text" id="name_${id}" placeholder="ì¥ì†Œ ëª…ì¹­">
                <textarea id="reason_${id}" placeholder="ì¶”ì²œ ì´ìœ " rows="2"></textarea>
                <select id="rating_${id}">
                    <option value="â­â­â­â­â­">â­ ìµœê³ </option>
                    <option value="â­â­â­â­" selected>âœ¨ ìš°ìˆ˜</option>
                    <option value="â­â­â­">ğŸ“ ì¼ë°˜</option>
                </select>
                <button class="save-btn" onclick="saveToFirebase(${latlng.lat}, ${latlng.lng}, ${id})">ë“±ë¡</button>
            </div>`;
        L.popup().setLatLng(latlng).setContent(content).openOn(map);
        toggleAddMode();
    });

    window.saveToFirebase = function(lat, lng, id) {
        const name = document.getElementById(`name_${id}`).value;
        const reason = document.getElementById(`reason_${id}`).value;
        const rating = document.getElementById(`rating_${id}`).value;
        if(name && reason) {
            database.ref('spots').push({ name, reason, rating, lat, lng, time: new Date().toISOString() })
            .then(() => { map.closePopup(); alert("ì œë³´ ì™„ë£Œ!"); });
        } else {
            alert("ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        }
    };
</script>
</body>
</html>
