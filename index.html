<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>2026 ì„œìš¸ì„¸ê³„ë¶ˆê½ƒì¶•ì œ ì§€ë„</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.css"/>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
        #map { width: 100vw; height: 100vh; background: #aad3df; }

        .header { 
            position: absolute; top: 0; left: 0; right: 0;
            background: rgba(26, 26, 46, 0.95); color:#fff; padding:12px; 
            text-align:center; z-index: 1001; border-bottom: 2px solid #ff6b6b;
        }

        /* ğŸ‡ ë¶ˆê½ƒ ì• ë‹ˆë©”ì´ì…˜ ì•„ì´ì½˜ (ìˆ˜ìƒ ì „ìš©) */
        .firework-main-icon {
            display: flex !important;
            align-items: center; justify-content: center;
            font-size: 35px !important;
            filter: drop-shadow(0 0 15px yellow);
            animation: fire-glow 1.5s infinite ease-in-out;
            z-index: 1000 !important;
        }
        @keyframes fire-glow {
            0%, 100% { transform: scale(1); opacity: 0.8; filter: drop-shadow(0 0 5px orange); }
            50% { transform: scale(1.2); opacity: 1; filter: drop-shadow(0 0 20px yellow); }
        }

        .control-panel { position: fixed; top:80px; right:20px; z-index:1000; }
        .add-btn { 
            padding:12px 24px; background:#ff6b6b; color:white; border:none; 
            border-radius:50px; cursor:pointer; font-weight:bold; 
            box-shadow:0 4px 15px rgba(0,0,0,0.4);
        }
        .legend { 
            position: fixed; bottom:30px; left:20px; background:white; 
            padding:15px; border-radius:12px; z-index:1000; font-size: 13px; 
            box-shadow: 0 0 20px rgba(0,0,0,0.3); border: 1px solid #ff6b6b;
        }
        
        .popup-form { min-width: 200px; padding: 5px; }
        .popup-form input, .popup-form textarea, .popup-form select { 
            width: 100%; margin-bottom: 8px; padding: 10px; border-radius: 8px; border: 1px solid #ddd; font-size: 14px;
        }
        .save-btn { width: 100%; padding: 12px; background: #2ecc71; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="header">
    <h1 style="margin:0; font-size: 1.2rem;">ğŸ‡ 2026 ì‹¤ì‹œê°„ ë¶ˆê½ƒ ëª…ë‹¹ ì§€ë„ ğŸ‡</h1>
</div>

<div id="map"></div>

<div class="control-panel">
    <button class="add-btn" onclick="enableAddSpot()">ğŸ“ ëª…ë‹¹ ì œë³´í•˜ê¸°</button>
</div>

<div class="legend">
    <div style="color: #ff4500; font-weight: bold; margin-bottom: 8px;">ğŸ”¥ ë¶ˆê½ƒ ë°œì‚¬ êµ¬ê°„ (ìˆ˜ìƒ)</div>
    <div style="font-size: 11px; color:#555; line-height: 1.4;">
        ë§ˆí¬ëŒ€êµ ~ í•œê°•ì² êµ ì‚¬ì´<br>ê°• í•œê°€ìš´ë° ğŸ‡ ì§€ì ì„ í™•ì¸í•˜ì„¸ìš”!
    </div>
    <hr style="margin: 8px 0; border: 0; border-top: 1px solid #eee;">
    <div style="display: flex; gap: 5px; font-weight: bold;">
        <span>â­ ìµœê³ </span> <span>âœ¨ ìš°ìˆ˜</span> <span>ğŸ“ ì¼ë°˜</span>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

<script>
    // [ì¤‘ìš”] Firebase ì£¼ì†Œ ì˜¤ë¥˜ ìˆ˜ì •: ë¶ˆí•„ìš”í•œ ê³µë°± ì œê±°ë¥¼ ìœ„í•´ trim() ì‚¬ìš©
    const rawUrl = "https://fireworks-map-50c05-default-rtdb.firebaseio.com/";
    const firebaseConfig = { 
        databaseURL: rawUrl.trim() 
    };

    // ì´ˆê¸°í™” ì‹œë„
    try {
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase Connected Successfully.");
        }
    } catch (e) {
        console.error("Firebase Initialization Error:", e.message);
        alert("Firebase ì—°ê²° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
    
    const database = firebase.database();

    // ì§€ë„ ì´ˆê¸°í™”
    const map = L.map('map', { zoomControl: false }).setView([37.528, 126.941], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    // ì‹¤ì œ ìˆ˜ìƒ ë°œì‚¬ ìœ„ì¹˜ (ì •ë°€ ìˆ˜ìƒ ì¢Œí‘œ ì¬êµì •)
    // ë§ˆí¬ëŒ€êµ(ë¶ë‹¨ìª½)ì—ì„œ í•œê°•ì² êµê¹Œì§€ ê°• ì¤‘ì‹¬ ë¼ì¸
    const bargePositions = [
        { name: "ë°œì‚¬ì§€ì  A (ë§ˆí¬ëŒ€êµ ì¸ê·¼ ìˆ˜ìƒ)", lat: 37.5342, lng: 126.9360 },
        { name: "ë°œì‚¬ì§€ì  B (ì›íš¨ëŒ€êµ ìƒë¥˜ ìˆ˜ìƒ)", lat: 37.5305, lng: 126.9388 },
        { name: "ë°œì‚¬ì§€ì  C (63ë¹Œë”© ì• ë©”ì¸ ìˆ˜ìƒ)", lat: 37.5265, lng: 126.9420 },
        { name: "ë°œì‚¬ì§€ì  D (í•œê°•ì² êµ ì¸ê·¼ ìˆ˜ìƒ)", lat: 37.5205, lng: 126.9490 }
    ];

    bargePositions.forEach((pos) => {
        // ğŸ‡ ë¶ˆê½ƒ ì•„ì´ì½˜ ë§ˆì»¤
        L.marker([pos.lat, pos.lng], {
            icon: L.divIcon({
                className: 'firework-main-icon',
                html: 'ğŸ‡',
                iconSize: [40, 40],
                iconAnchor: [20, 20]
            })
        }).addTo(map).bindPopup(`<b>${pos.name}</b><br>ì‹¤ì œ ìˆ˜ìƒ ë°”ì§€ì„  ìœ„ì¹˜ì…ë‹ˆë‹¤.`);
        
        // ë°œì‚¬ ìœ„í—˜/ì—°ì¶œ ë°˜ê²½
        L.circle([pos.lat, pos.lng], { 
            color: '#ff4500', weight: 1, fillColor: '#ffcc00', fillOpacity: 0.1, radius: 250 
        }).addTo(map);
    });

    // ëª…ë‹¹ ì•„ì´ì½˜ ë¡œì§
    function getCustomIcon(rating) {
        let iconHtml = 'ğŸ“'; let bgColor = '#4facfe';
        if (rating === "â­â­â­â­â­") { iconHtml = 'â­'; bgColor = '#FFD700'; }
        else if (rating === "â­â­â­â­") { iconHtml = 'âœ¨'; bgColor = '#C0C0C0'; }
        return L.divIcon({
            html: `<div style="background:${bgColor}; width:34px; height:34px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:16px; color:white; border:2px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">${iconHtml}</div>`,
            className: '', iconSize: [34, 34], iconAnchor: [17, 17]
        });
    }

    // ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë“œ
    database.ref('spots').on('child_added', (snapshot) => {
        const data = snapshot.val();
        L.marker([data.lat, data.lng], { icon: getCustomIcon(data.rating) })
            .bindPopup(`<strong>${data.name}</strong><br><span style="color:#f39c12">${data.rating}</span><p style="margin-top:5px;">${data.reason}</p>`)
            .addTo(map);
    });

    // ë“±ë¡ ê¸°ëŠ¥
    window.enableAddSpot = function() {
        alert("ğŸ“ ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ë‹¹ì‹ ì˜ ëª…ë‹¹ì„ ê³µìœ í•´ ì£¼ì„¸ìš”!");
        new L.Draw.Marker(map).enable();
    };

    map.on(L.Draw.Event.CREATED, function (e) {
        const latlng = e.layer.getLatLng();
        const id = Date.now();
        const content = `
            <div class="popup-form">
                <input type="text" id="name_${id}" placeholder="ì¥ì†Œ ì´ë¦„ (ì˜ˆ: ì›íš¨ëŒ€êµ ë¶ë‹¨)">
                <textarea id="reason_${id}" placeholder="ì¶”ì²œ ì´ìœ " rows="3"></textarea>
                <select id="rating_${id}">
                    <option value="â­â­â­â­â­">â­ ìµœê³  ëª…ë‹¹</option>
                    <option value="â­â­â­â­" selected>âœ¨ ìš°ìˆ˜ ëª…ë‹¹</option>
                    <option value="â­â­â­">ğŸ“ ì¼ë°˜ ëª…ë‹¹</option>
                </select>
                <button class="save-btn" onclick="saveToFirebase(${latlng.lat}, ${latlng.lng}, ${id})">ê³µìœ í•˜ê¸°</button>
            </div>`;
        L.popup().setLatLng(latlng).setContent(content).openOn(map);
    });

    window.saveToFirebase = function(lat, lng, id) {
        const name = document.getElementById(`name_${id}`).value;
        const reason = document.getElementById(`reason_${id}`).value;
        const rating = document.getElementById(`rating_${id}`).value;
        if(name && reason) {
            database.ref('spots').push({ name, reason, rating, lat, lng, time: new Date().toISOString() })
            .then(() => { map.closePopup(); alert("ì œë³´ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"); });
        } else {
            alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        }
    };
</script>
</body>
</html>
